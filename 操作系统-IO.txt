40.I/O设备
    I/O设备的基本概念与分类
        什么是I/O设备
            将数据Input/Output（输入/输出）计算机的外部设备
        按使用特性分类
            人机交互类外部设备
            存储设备
            网络通信设备
        按传输速率分类
            低速设备
            中速设备
            高速设备
        按信息交换的单位分类
            块设备（传输块，可寻址）
            字符设备（传输慢，不可寻址，常采用中断驱动方式）
    I/O控制器
        主要功能
            接收和识别CPU发出的命令（要有控制寄存器）
            向CPU报告设备的状态（要有状态寄存器）
            数据交换（要有数据寄存器，暂存输入/输出的数据）
            地址识别（由I/O逻辑实现）
        组成
            CPU与控制器之间的接口（实现控制器与CPU之间的通信）
            I/O逻辑（负责识别CPU发出的命令，并向设备发出命令）
            控制器与设备之间的接口（实现控制器与设备之间的通信）
        两种寄存器编址方式
            内存映射I/O
                控制器中的寄存器与内存统一编址
                可以采用对内存进行操作的指令来对控制器进行操作
            寄存器独立编址
                控制器中的寄存器独立编址
                需要设置专门的指令来操作控制器
    I/O控制方式
        程序直接控制方式
            完成一次读/写操作的流程
            CPU干预的频率
                很频繁，I/O操作开始之前、完成之后需要CPU介入，并且在等待I/O完成的过程中CPU需要不断地轮询检查
            数据传送的单位
                每次读/写一个字
            数据的流向
                读操作（数据输入）：I/O设备->CPU->内存
                写操作（数据输出）：内存->CPU->I/O设备
            主要缺点和优点
                优点：实现简单。在读/写指令后，加上实现循环检查的一系列指令即可（因此才称为“程序直接控制方式”）
                缺点：CPU和I/O设备只能串行工作，CPU需要一直轮询检查，长期处于“忙等”状态，CPU利用率低
        中断驱动方式
            完成一次读/写操作的流程
            CPU干预的频率
                每次I/O操作开始之前、完成之后需要CPU介入。等待I/O完成的过程中CPU可以切换到别的进程执行
            数据传送的单位
                每次读/写一个字
            数据的流向
                读操作（数据输入）：I/O设备->CPU->内存
                写操作（数据输出）：内存->CPU->I/O设备
            主要缺点和优点
                优点：与“程序直接控制方式”相比，I/O控制器会通过中断信号主动报告I/O已完成，CPU不再需要不停地轮询。CPU和I/O设备可并行工作，CPU利用率得到明显提升。
                缺点：每个字在I/O设备与内存之间的传输，都需要经过CPU。而频繁的中断处理会消耗较多的CPU时间
        DMA方式
            完成一次读/写操作的流程
            CPU干预的频率
                仅在传送一个或多个数据块的开始和结束时，才需要CPU干预
            数据传送的单位
                每次读/写一个或多个块（注意：每次读写的只能是连续的多个块，它们读入内存后也是连续的）
            数据的流向
                读操作（数据输入）：I/O设备->内存
                写操作（数据输出）：内存->I/O设备
            主要缺点和优点
                优点：数据传输以“块”为单位，CPU介入频率进一步降低。数据的传输不再需要先经过CPU再写入内存，数据传输效率进一步增加
                缺点：CPU每发出一条I/O指令，只能读/写一个或多个连续的数据块
        通道控制方式
            完成一次读/写操作的流程
            CPU干预的频率
                极低，通道会根据CPU的指示执行相应的通道程序，只有完成一组数据块的读/写之后才需要发出中断信号，请求CPU干预
            数据传送的单位
                每次读/写一组数据块
            数据的流向
                读操作（数据输入）：I/O设备->内存
                写操作（数据输出）：内存->I/O设备
            主要缺点和优点
                优点：CPU、通道、I/O设备可并行性工作，资源利用率很高
                缺点：实现复杂，需要专门的通道硬件支持
    I/O软件层次结构
    I/O核心子系统
    假脱机技术/SPOOLing技术
        脱机技术
            外围控制机+更高速的设备--磁带
            作用：缓解设备与CPU的速度矛盾，实现预输入、缓输出
        假脱机技术
            又叫SPOOLing技术，用软件的方式模拟脱机技术
            输入井和输出井--模拟脱机输入/输出时的磁带
            输入进程和输出进程--模拟脱机输入/输出时的外围控制机
            输入缓冲区和输出缓冲区--内存中的缓冲区、输入、输出时的“中转站”
        共享打印机
            用SPOOLing技术将独占式的打印机“虚拟”成共享打印机
    设备的分配与回收
        应考虑的因素
            固有属性
                独占设备、共享设备、虚拟设备
            分配算法
                先来先到服务、优先级高者优先、短任务优先等
            安全性
                安全分配方式、不安全分配方式
        静态分配与动态分配
            静态分配：进程运行前为其分配全部所需资源，运行结束后归还资源
            动态分配：进程运行过程中动态申请设备资源
        设备分配管理中的数据结构
            设备控制表（DCT）
                每个设备对应一张DCT，关键字段：类型/标识符/状态/指向COCT的指针/等待队列指针
            控制器控制表（COCT）
                每个控制器对应一张COCT，关键字段：状态/指向CHCT的指针/等待队列的指针
            通道控制表（CHCT）
                每个控制器对应一张CHCT，关键字段：状态/等待队列指针
            系统设备表（SDT）
                记录整个系统中所有设备的情况，每个设备对应一个表目，关键字段：设备类型/标识符/DCT/驱动程序入口
        设备分配的步骤
            1.根据进程请求的物理设备名查找SDT
            2.根据SDT找到DCT并分配设备
            3.根据DCT找到COCT并分配控制器
            4.根据COCT找到CHCT并分配通道
        设备分配步骤的改进
            用户编程时使用逻辑设备申请设备，操作系统负责实现从逻辑设备名到物理设备名的映射（通过LUT）
            逻辑设备表的设置问题
                整个系统只有一张LUT：各用户所用的逻辑设备名不允许重复
                每个用户一张LUT：各个用户的逻辑设备名可重复
    缓冲区管理
        缓冲区的概念
            一般利用内存作为缓冲区
            缓解CPU与设备的速度矛盾、减少时对CPU的中断频率、解决数据粒度不匹配的问题、提高CPU与I/O设备之间并行性
        单缓冲
            设备--（T）--缓冲区--（M）--工作区--（C）--处理
            处理一块数据平均耗时Max（C,T）+M
            分析问题的初始状态：工作区满，缓冲区空
        双缓冲
            处理一块数据平均耗时Max（T,C+M）
            分析问题的初始状态：工作区空，一个缓冲区满，另一个缓冲区空
        循环缓冲
            多个缓冲区链接成循环队列，in指针指向第一个空缓冲区，out指针指向第一个满缓冲区
        缓冲池
            三个队列：空缓冲队列、输入队列、输出队列
            四种工作缓冲区
                用于收容输入数据的工作缓冲区、用于提取输入数据的工作缓冲区
                用于收容输出数据的工作缓冲区、用于提取输出数据的工作缓冲区