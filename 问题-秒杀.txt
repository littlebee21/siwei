秒杀
    结构单层面
        高可用系统建设
            架构阶段
                异地容灾
                异步化
                分组隔离
                避免单点
            编码阶段
                限流保护
                超时处理
                异步线程
                错误捕获
            测试阶段
                beta测试
                自动化对比测试
            发布阶段
                分批发布
                多版本发布
            运行阶段
                数据对账
                自动降级
                过载保护
                实时监控报警
            故障发生
                故障定位
                快速恢复
        架构原则
            数据要尽量少
                请求数据和返回数据少
                系统依赖数据少
            请求数要尽量少
                合并 CSS 和 JavaScript 文件
            路径要尽量短
                多个相互强依赖的应用合并部署在一起，把远程过程调用（RPC）变成 JVM 内部之间的方法调用
            依赖要尽量少
                给系统进行分级，防止重要系统被不重要系统拖垮
            避免单点
                机器配置动态化
                应用无状态化
    解决方案按照可行性排序
        架构
            1.系统拆分（2000万用户，2000/s请求）
            2.缓存（6000万个用户，6000/s请求）
            3.MQ（1亿用户，1万请求/s）
            4.分库分表（2亿用户，2万请求/s）
            5.数据库读写分离（5亿用户，每秒5万个请求）
            6.ElasticSearch
                es集群是分布式的，可以放几十亿的数据量，用20台机器，每秒可以支撑几万的请求
        jvm提升性能
            性能因素
                减少CPU执行时间
                合理的并发线程数
            发现瓶颈
                CPU诊断工具：JProfiler 和 Yourkit 
                jstack 定时地打印调用栈
            优化系统
                减少编码
                    网页输出可以直接进行流输出
                    Velocity 优化实践
                减少序列化
                Java极致优化
                    直接使用 Servlet 处理请求
                    直接输出流数据
                并发读优化
                    应用层的 LocalCache
        nginx
            数据的动静分离
                静态数据缓存
                    把静态数据缓存到离用户最近的地方
                        统一Cache层
                        使用CDN二级缓存
                            失效问题
                            命中率问题
                    直接缓存 HTTP 连接
                    Web层做缓存：Web 服务器（如 Nginx、Apache、Varnish）更擅长处理大并发的静态文件请求
                动静分离改造
                    URL 唯一化
                    分离浏览者相关的因素
                    分离时间因素
                    异步化地域因素
                    去掉 Cookie
                动态内容处理
                    ESI 方案
                    CSI 方案
            集群部署时钟同步
        业务层面算法优化
            redis
                减库存方式
                    下单减库存
                        在应用程序中通过事务来判断，即保证减后库存不能为负数，否则就回滚
                        直接设置数据库的字段数据为无符号整数，这样减后库存字段值小于零时会直接执行 SQL 语句来报错
                        使用 CASE WHEN 判断语句
                    付款减库存
                    预扣库存
                优化
                    缓存中减库存
                        适合缓存逻辑单一场景
                    数据库中减库存
                        并发锁问题
                            应用层排队
                            数据库层排队
                库存预热热点数据
                    发现
                        发现静态热点数据
                            报名筛选
                            大数据Top N
                        发现动态热点数据
                    处理
                        优化
                            缓存热点数据
                        限制
                            id一致性hash
                        隔离
                            业务隔离
                                秒杀报名，提前预热
                            系统隔离
                                分组部署，单独域名
                            数据隔离
                                单独Cache/MySQL
        算法
            哪些服务时候做服务降级
                人工降级
                被动降级
                    如何配置
            流量削峰
                简化
                分层过滤
                    服务层
                        读请求做缓存
                        数据的二次校验
                限流
                    浏览器层
                        按钮置灰，禁止重复提交
                        限制X秒只能提交一次
                    服务器限流
                        相同UUID，限制访问频率
                        线程池隔离
                        固定窗口计数
                            Redis+Lua脚本实现分布式限流思路
                                创建注解
                                创建切面类
                                创建limit.lua脚本文件
                                接口添加注解
                                测试分布式限流
                            Nginx+Lua实现分布式限流
                        限流计数器
                            信号量计数
                        令牌桶算法限流
                    数据层
                        强一致性校验
                答题
                    基于时间分片肖锋
                排队
                    rabbitmq消息的异步响应
                    线程池加锁等待
                    请求序列化到文件，顺序恢复
                    写请求进消息队列
                plan B 兜底
                    降级
                        流量超过阈值服务降级
                    拒绝服务
            递交订单支付
                支付回调
                    物流系统
                    消息平台
    秒杀带来的业务问题
        9.电商活动倒计时方案
        热点发现
            单机内存设置阈值
            识别到是热点后就处理策略
                升级为本地缓存
        防止超卖
            程序计数器
    常见的秒杀问题
        大量读问题
            单条微博访问量大了怎么办
        大量读写问题
            外卖骑手抢单保证只有一个能抢到
        大量写问题
            .秒杀抢购库存解决方案
    并发问题
        1000个任务分给10个人做
        如何把一个文件快速下发到 100w 个服务器